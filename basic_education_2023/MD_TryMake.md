# モータードライバー製作

## モータードライバーとは
モーターを制御するために必要なもの。モタドラ、MDと言います。(以下MDと呼びます)

モーターを自由に制御する(逆回転したり停止したり速度を変えたりする)ためにはマイコンから指令を送る必要があります。

マイコンとモーターをつなげばいいので、マイコンのGPIOにモーターをつなげたらMD完成...というわけではありません。

理由としては、マイコンのGPIOは基本、電流出力が数mA程度しかありませんが、モーターを動かすためには数Aが必要になるためです。

そのため、最悪マイコンが燃えます。

そうならないように、マイコンからモーターを動かすようにするのが、MDの役割と言えます。

ちなみにここでいうモーターはDCモーターで話を進めています。

### 課題1(基本)
課題1：モーターの回転と停止が制御できるＭＤを作る。

十分な電流(VDDとして表記)、スイッチ、モーター、GNDで作れます。マイコンは使わないで考えてください。

やってみましょう！手書きの紙かＣＡＤのデータかスクショでも送ってくれればみます。

### 課題2(素子理解)
課題2:課題1ではスイッチを使用しましたが、スイッチを違う電子部品に置き換えて作成してください。

置き換えヒント→スイッチング作用がある、MOSFETを使用する。

MOSFETってなんだっけという人はこちらへ

### 課題3(Hブリッジ回路)
課題3:正転と逆転、停止ができるMDをつくる。

スイッチを使用すること。個数は問わない。

### 課題4(2の応用)
課題4:課題2の内容を課題3に反映して回路を作成してください。

要するにスイッチではなくMOSFETを使ってくださいってことです。(N,Pchなどの種類は問いません)

## MDの構造
MDには基本的に構造が三つに分けられます。

・信号部

マイコンから信号を受けて動作する場所。低電流。

・電源部

モーターに電力をぶち込むところ。一番電流が流れる。保護回路を付けてもいい。

・増幅部

先述した信号部と電源部をつなぎ、モーターにつなぐ。ここがMDの性能を決める。

## MDの種類
これはさっきやった課題に近い話です。
課題が理解できていればおそらく大体はできる。

MDにはいろいろ種類があります。例として挙げると、

・フルNchFET

・NPchFET

・モータドライバIC

等々。

ということで作ってみましょう。

課題4の同じ回答になる人も居ると思います。
各課題に解答と特徴を載せます。

### 課題5(フルNchFET)
名前の通り、すべてがNchのMOSFETで構成されています。

課題4:MOSFETを使用し、正転と逆転、停止ができるMD回路を作成してください。
で、MOSFETをすべてNchにすればオッケーです。

ということで、

課題5:課題4のMOSFETをNchにしてください。

課題5の解答

<img src="https://github.com/TNCTRobocon/manuals_markdown/assets/110577719/3ec82584-5a16-4720-84eb-ecf5dc1ece09" width="70%">


作ってもらっておいてですが、この回路には問題点があります。

それは、ゲートの駆動がめんどいという点です。

理由としては、HIGH側にもNchFETを使っているため、昇圧しなきゃいけない点です。

回答の回路を見てください。

Q1,Q3は、ONのときのソースの電圧はドレインの電圧にほぼ等しいことを考慮すると、VDD(電源電圧) 以上の電圧をゲートに加えないといけないことになります。

ちなみにQ2,Q4は今まで通り、GNDに対しての電圧をINPUTにぶち込めばオッケーです。

言いたいこととしては、昇圧する必要があって、めんどうだねってことです。

### 課題6(NPchFET)
名前の通り、Pch,NchのMOSFETで構成されています。

課題4:MOSFETを使用し、正転と逆転、停止ができるMD回路を作成してください。
で、MOSFETのPch,Nchを使い分ければオッケーです。

ということで、

課題6:課題4のMOSFETをNchとPchで使い分けてください

課題6の解答

<img src="https://github.com/TNCTRobocon/manuals_markdown/assets/110577719/e8a9e577-2a33-41a4-9d49-cab6e9121b5c" width="70%">

Q1,Q3がPchMOSFETになりました。

こうすると、課題5のように昇圧しなきゃいけない問題はありません。

### 課題7(課題6のロボコンへの応用)
課題6をロボコンへ応用してみましょう。

基本的には、マイコンを通して、MDを使ってモーターを制御します。

一番最初に先述しましたが、MDはマイコンから動かしたいものです。

というわけで、マイコンから動かせるようにしましょう。

課題7:課題6をマイコンから動かせるようにしてください。しかし、トランジスタを用いること。

ヒント:トランジスタはレベル変換用に使うといいです。

レベル変換とは、電圧の異なる信号線をつなぐ際に電圧を変換することです。

課題7の解答

こちらが回答ですどーん

<img src="https://github.com/TNCTRobocon/manuals_markdown/assets/110577719/2e46e44a-4ce7-4ab3-8dab-03d8bc364b4f" width="70%">


トランジスタがレベル変換してマイコンからのGPIOの3.3V入力でモーターが回る仕組みですね。

またしても作ってもらってなんですが、この回路には問題点があります。

それは、PchMOSFETのON抵抗が高い点です。

ON抵抗とは、MOSFETが導通したときのDS間の仮想的な抵抗の抵抗値のことです。
導通したとき、ドレイン・ソース間は抵抗のようにふるまうため、抵抗値が生まれています。

Nchに比べて、PchはそのON抵抗が倍レベルで高いのです。
そして、大電流を流した時、Pchは発熱を起こします。

そのため、あまり大電流を流すことはできません。

この回路で扱えるのは、小さいモータほどになります。(385でいけるか怪しいくらい)

また、もう一点あります。
MOSFETの駆動の遅い点です。

ゲート・ソース間の仮想的なコンデンサの充放電により時間がかかるため、信号の入力からMOSFETがON/OFFするまでに時間のラグがあるためです。

そのラグがあるとPWM制御をするときにちょっと問題になるので配慮した方がいいです。

あとロボコン的視点でみると、VDDが15Vほどしか入れられない設計になるので、24Vを多く使うロボコン的にはあんまりよくないです。

### 課題8(課題5:フルNchの応用)
NPchはロボコン向きでない...じゃあロボコンにおけるMDはどんなのを作ればよいのかを学びます。

課題5では、フルNchMOSFETを使用して、正転/逆転ができる回路を作成しました。

そこに、ゲートドライバというICを加えます。

ゲートドライバとは、MOSFETのゲートに十分な電圧を供給し、駆動させる役割を持つもののことです。
この子がいると、昇圧回路を組まなければいけないという問題が解決されます。
ゲートドライバの仕組み等の記事は気が向いたら書きます。

最終更新日:2024/3/15
