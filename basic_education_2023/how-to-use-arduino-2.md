# Arduinoを使ってみよう！ (その2)

## もくじ
* 1.Arduino IDEの起動と画面の説明 //[リンク](how-to-use-arduino-1.md)
* 2.Arduinoを使ってLチカをしてみよう！ //今回はこれ
* 3.Arduinoを使ってPWMを体験してみよう！　//[リンク](how-to-use-arduino-3.md)  
* 4.Arduinoを使ってデジタル入力を体験してみよう！ //[リンク](how-to-use-arduino-4.md)  
* 5.Arduinoを使って自由に明るさを変えてみよう！（上級編） //[リンク](how-to-use-arduino-5.md)  

## 2.Arduinoを使ってLチカをしてみよう！
前回、Arduino IDEを開いたところからスタートだ。  
...がみなさん思ったことだろう。  
**Lチカって何？** と。  
Lチカとは、「LEDをチカチカさせる」の略です。(...え？)  
ロボコンAではよく使う言葉なので、覚えておこう。  
### 2-1 回路を作ろう！
そもそも、Arduinoでプログラムを書いたとしても、つけるLEDがなかったら意味がない。  
そこで、まずは回路を作る。
そして今回は、ブレッドボードというものを使う。  

<img src="https://user-images.githubusercontent.com/106954082/228743741-5030149a-40f1-4ebc-b45e-969fdf71e961.jpg" width="30%">

これのこと。

これの使い方について説明する。  

<img src="https://user-images.githubusercontent.com/106954082/228745989-886c0635-d565-4d32-9e69-351bf8846512.png" width="30%">
  
上の図を見てほしい。
ブレッドボードにはたくさんの穴があいている。  
これ、黒い線の方向には電気的に**つながっている**。逆に赤い線の方向にはつながっていないので注意しよう。  
これを使うと簡単に回路を作ることができる。  
今回は、LEDと抵抗をArduinoにつなぐ回路を作る。

<img src="https://user-images.githubusercontent.com/106954082/228750401-eda567d5-e7cb-4291-b05f-410239e838fd.png" width="30%">
  
こんな感じで、写真を参考にして回路を作ってみよう。（写真は、Arduino nano every を使用した例）  
どの部品を使うかは先輩に聞いてほしい。 そして、できたら先輩に一度見てもらおう。

<details> <summary>回路図、回路づくりの時に見るといいこと</summary>
  回路図  
 　
  <img src="https://user-images.githubusercontent.com/106954082/228752447-607c2784-b72e-4b41-b088-2d29948675d7.png" width="30%">

  <h4>LEDの向きについて</h4>
  LEDには極性がある。（中学校でやったよね。）  
  ＋の方を"アノード"、－の方を"カソード" という。  
  
  <br>
  
  <img src="https://user-images.githubusercontent.com/106954082/228756459-627ef8fc-2285-4dfe-8bb4-540ce061d35d.png" width="30%">
    
  向きを間違えると、光らなかったり、壊れたりする。
  <br>
  <h4>抵抗のカラーコードについて</h4>
  抵抗の大きさはカラーコードで示されることがある。
  <br>
  <img src="https://user-images.githubusercontent.com/106954082/228759694-6882f548-39da-4271-ab6b-148180b258ce.png" width="30%">
  <br>
  詳しくは、「抵抗のカラーコード」で検索してみてほしい。
  
  </details>
    
回路ができたら次に進もう。

### 2-2 プログラムを書こう！
次にあなたは、Arduinoに書きこむプログラムを書かなければならない。    

初めてなので一緒にやっていこう。  
<br>

以前見た Arduino IDEのプログラムを書くところには、  
```cpp
void setup(){}
```  
と、
```cpp
void loop(){}
```
がある。  
<br>

この二つは大事なので、説明する。  
まず、
```cpp
void setup(){}
```
は、プログラム開始時に一度だけ実行される(おおきな)関数だ。  
主にピンの初期設定など、一度だけ実行すればいいことを入れる。  

次に、
```cpp
void loop(){}
```
は、先ほどの```setup()```実行後に、実行される(おおきな)関数であり、  
ずっとループして実行される。  
そのため今回のようにずっと点滅させ続けたりするなど、繰り返しが必要な処理に使用する。  

<br>
さて、今回はLチカをしたい...つまり、LEDをつけたり消したりすればいい。  

まずは、ピンの設定 が必要だ。  
  
ピンの設定をしないと、Arduinoからは電気が流れない。（つまりLEDがつかない）  
そのため、まずはLEDとつながる（＋）側のピンが電流を出せるように初期設定をする。  

初期設定は一度だけでいい。  
つまり、書く場所は
```cpp
void setup(){}
```  
であることがわかる。  

ここで、ピンの初期設定をする関数は、
```cpp 
pinMode(pin, mode);
```
と言う。  
```pin```にピンの番号を、```mode```に今回は電流を出すので、```OUTPUT```を書いてほしい。  

初期設定ができたら、LEDのON/OFFを制御しよう。
先ほどの設定したピンから電流を流す/止めるは、
```cpp
digitalWrite(pin, val);
```
という関数を使う。
```pin```にはピンの番号を書き、```val```は```HIGH```で電流を流し、```LOW```で電流を流すことができるようになる。  

そして、この関数を  
```cpp
void loop(){}
```
で繰り返せばLEDは点滅する。  
しかし、一瞬で処理されるので、このままだと早く光りすぎてしまう。  
そこで、この間に一時停止の関数  
```cpp
delay(ms);
```
を使うことをお勧めする。```ms```に待ってほしい時間をミリ秒(1/1000 sec)単位で入れると、その間そこで処理が止まる。  つまり、LEDを光らせた/消したまま 待ってくれるというわけだ。  
個人的なおすすめは、50ミリ秒～500ミリ秒の範囲だが、自由に設定してみてください。  

<br>
さて、ここまでで必要な関数は説明した。では実際にプログラムを書いてみよう。  

IDEを開くと、
```cpp
void setup(){
  //put your ...
  
}

void loop(){
  //put your ...

}
```
こんな感じになっていると思う。  
```//put your ...```と書かれた部分、つまり{}←このかっこの中に先ほどの関数たちを入れる。  
答えを見る前に 自分でやってみよう。  
終わったら、下の答えのプログラム例を開いて、自分のものと見比べてみよう。

<details> <summary>答えのプログラム例</summary><div>
  
```cpp
//出力を11番ピン, 間隔を100ミリ秒にした例
void setup(){
  pinMode(11, OUTPUT); //ピンの初期設定
}
  
void loop(){
  digitalWrite(11, HIGH); //11番ピンから電流を流す
  delay(100);             //100ms待つ
  digitalWrite(11, LOW);  //11番ピンからの電流を止める
  delay(100);             //100ms待つ
}
```
</div> 
ちなみに解答例のように、関数の最後には、";"(セミコロン)が必要である。  
また、必ずしも、回答例と同じでなければならないわけではないので、自分で判断してみよう。  
では進んで、動作確認をしよう。
</details>

### 2-3 コンパイルとLチカ本番
まず用語を解説しよう、「コンパイル」というのは、私たちが書いたプログラムを、機械語に変換する処理のことだ。  
「コンパイル」をするとエラーが返ってくることがある。  
これを「コンパイルエラー」と言ったりもする。  

では、まずは書きこむためにArduinoをパソコンにUSBでつなごう。  
つないだら、上の方にある"ツール"をクリックしよう。

<img src="https://user-images.githubusercontent.com/106954082/228871462-a31d689a-405a-4d5f-96f9-e617aaa8fb87.png" width="30%">

そこで、**ボード**、**プロセッサ**、**シリアルポート**が正しく選択されているか確認しよう。  
<img src="https://user-images.githubusercontent.com/106954082/228872130-e5689db9-72c9-4463-85cd-341465f8b8a8.png" width="30%">
(画像は、Arduino megaの例 **シリアルポートは選択されていない** ~~てか、そもそもつなげていない~~)
    
(初心者にはわかりにくいので、先輩に確認するとよい。)  (画像のプログラムは、今回と全く関係がない。)  

そうしたら、プログラムをパソコンからArduinoに書きこもう。  
IDEにある右矢印の白丸を押す。  

<img src="https://user-images.githubusercontent.com/106954082/228874857-14ddce00-8465-4459-9655-1720d5ed5f98.png" width="30%">
  
するとコンパイルが始まり、その後Arduinoに書きこまれる。
「ボードへの書き込みが完了しました。」とIDEに表示されたら書き込み成功だ。  
ここで、LEDが点滅していたら大成功だ。 おめでとう。

次回は、PWMを使ってLEDの明るさを操ってみよう。
3.Arduinoを使ってPWMを体験してみよう！ は、[こちら](how-to-use-arduino-3.md)  
written by つつさん 2023/03/31

#### 練習問題
Q: 2つのLEDをLチカせよ。 ただし、一方のLEDが光る処理をしたら、もう一方のLEDは消す処理をして、交互に光るようにせよ。  
また、点滅間隔は100ミリ秒とする。  
<details> <summary>Answer</summary><div>
  
回路例 //写真載せます  
  
  
プログラム例
```cpp
//出力を10, 11番ピンにした例
void setup(){
  pinMode(10, OUTPUT);
  pinMode(11, OUTPUT);
}
  
void loop(){
  digitalWrite(10, HIGH);
  digitalWrite(11, LOW);
  delay(100);
  digitalWrite(10, LOW);
  digitalWrite(11, HIGH);
  delay(100);
}
```
</div></details>
