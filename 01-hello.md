# あらすじ

## 序章

あなたは、未知の星(環境)を開拓(開発)するエンジニアです。
不慮の事故により、未開の星(環境)に不時着(アサインされて)して
しまいました。しかし、あなたは、この未開の星(環境)を整えて、
ロケット(成果物)を打ち上げなくてはいけません。

> まあ、Factorio的な世界観です。
> あと、茶番は読み飛ばしてもらって構いません。

## 真っ暗闇の中で

あなたは未開の星(環境)がどうなっているのか調べなくてはいけません。
そのためには、まず明かり(デバック環境)を用意しましょう。

# 演習

本演習は、今後の前提となる文字の出力関数を実装します。
なお、開発環境ごとに手順がことなるため、適時読み替えて実装してください。

## マイコン環境

マイコン環境において最初にするべきことは次の手順です。

1. LEDを光らせる
2. UARTでなんからの文字を出力する
3. UARTでなんからの文字列を出力する
4. 割り込みを用いてを文字列を出力する
5. DMAを用いて文字列を出力する(難易度を上げたい人向け)

今回に関しては、擬似コードでしか説明できないため、擬似コードを
用いて説明していきます。

### 1.LEDを光らせる

次のようなコードを記述します。

1. クロックを設定する
   + PLLを有効にする必要がある場合はPLLをロックする
2. GPIOを初期化する
   + 入出力方法を設定する
   + 他の機能を無効化する(例: ADC)
3. LEDを反転させる
4. 一定時間時間待つ
   + 最初は何もしないfor文を回すといいでしょう
5. 3に戻る

```c
#define LED //TODO: 設定すること

void main(){
  init();
  while(1){
    LED=!LED;
    delay(1000);//適当
  }
}

void init(){
  clock_init();
  gpio_init();
}
```

ヒント: 

* オシロスコープを持っている場合、意図した周波数になっているか
  確認するといいでしょう
* コンパイラの最適化を防ぐために、`volatile`を利用するといいでしょう

### 2. UARTで文字を出力する

次のようなコードを記述します。

1. クロックを設定する
   + PLLを有効にする必要がある場合はPLLをロックする
2. GPIOを初期化する
   + 入出力方法を設定する
   + 他の機能を無効化する(例: ADC)
3. UARTを初期化する
4. TXREGのBUSYフラグが消えるまで待機する
5. TXREGになんからの文字を書きこむ。
6. 4に戻る

```c
#define TXREG //TODO: 設定すること
#define TXBUSY //TODO: 設定すること

void main(){
  init();
  while(1){
    uart_putc('a');//適当
  }
}

void init(){
  clock_init();
  gpio_init();
  uart_init();//115200bps
}

void uart_putc(char c){
  while(TXBUSY);
  TXREG=c;
}
```

### 3. UARTで文字列を出力する

2とあまり変わりませんが、次のようなコードを記述します。

1. クロックを設定する
   + PLLを有効にする必要がある場合はPLLをロックする
2. GPIOを初期化する
   + 入出力方法を設定する
   + 他の機能を無効化する(例: ADC)
3. UARTを初期化する
4. 文字列の先頭から最後までの文字cを取得する。
   1. TXREGにcを書きこむ。
   2. TXREGのBUSYフラグが消えるまで待機する
5. 4に戻る

```c
#define TXREG //TODO: 設定すること
#define TXBUSY //TODO: 設定すること

void main(){
  init();
  while(1){
    uart_puts("hello planet\n");//適当
  }
}

void init(){
  clock_init();
  gpio_init();
  uart_init();//115200bps
}

void uart_puts(const char* s){
  for(;*s!='\0';s++){
    uart_putc(*s);
  }
}

void uart_putc(char c){
  while(TXBUSY);
  TXREG=c;
}

```

### 4. 割り込みを用いて文字列を実装する

TODO: 明日書く

ヒント: 

* 私が開発したモータードライバーのコードを参考にしてください。
  + [MDU_COM](https://github.com/TNCTRobocon/MDU_COM)
