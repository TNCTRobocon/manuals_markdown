# 参照

## 参照とは

```c++
#include<iostream>
int main(){
    int num = 20;

    int &ref = num;

    ref = 0;

    std::cout << num << std::endl;

    return 0;
}
```

出力

```markdowm
0
```

変数の頭に&をつけている変数が参照である  
&は変数のアドレスを見る時に使う演算子(アドレス演算子)だが、変数宣言時にこのように使うと参照変数になる

このコードでは参照変数refは宣言時に変数numを代入している  
そしてrefを通してnumを書き換えることができている  
つまり、ポインタとほぼ同じことができるわけである

参照の注意点として宣言と初期化(代入)を同時に行わなくてはならないので注意しなければならない(後の項でもう一度触れる)

## 参照とポインタの違い

前の項目の最後にポインタと同じことができるといった  
それではポインタと参照の何が違うのか詳しく見ていこう

ポインタは変数のメモリ上のアドレスであることは覚えていると思う  
では参照はどうか、参照はその変数そのものである

また、**参照はそれ自体が常に何らかのオブジェクトをさしていることを求められる**  
ポインタのようになにもさしていないポインタやNULLポインタ(何もさしていないポインタ)を作ることができない

さっき参照は常に何らかのオブジェクトをさしている必要があるといった  
ということは、参照は変数の宣言と同時に変数の代入を行う必要があるということも頭に入れておいてほしい

実際に見ていこう

```c++
//ポインタ
int*p1;
int*p2 = NULL;
int*p3 = (int*)1;

//参照
//いずれもエラー
int &r1;
int &r2 = NULL;
int &r3 = (int&)1;

//正しい表記
int num = 0;
int&r4 = num;

//エラー
int&r5;
```

参照は宣言の時に代入が必要と述べたが、なんとこの**参照は途中で別のオブジェクトをさすことができない**

```c++
int num = 0;
int num2 = 1;

int&r = num;//OK
&r = num2;//エラー
```

このように参照は元のオブジェクトと深くかかわりあっている

## 参照渡し

ポインタで値を渡すことを配列や構造体など大きなサイズの変数でしたことがあると思う  
今回はそれの参照バージョンだと思ってもらって構わない

引数で受け取った変数はポインタではなく、**実引数そのもの**なのでポインタと同じように扱うとエラーになる

### 参照渡しの速さ

結論から言うと

**参照渡しの速度はポインタ渡し並に早い**

なので積極的に使ったほうがよい

### const参照

参照渡しで渡された変数は実引数そのものと書いた  
つまり、呼び出した先の関数で書き換えられる可能性がある

つまり、気づかない間に変数の中身が書き変わる可能性がある

そこで活躍するのがconst参照である

```c++
int func(int&ref){
    ref = 1;
    //numが書き換えられてしまう
}

int func_const(const int&ref){
    ref = 1;//エラー 
}

int main(){
    int num1 = 0, num2 = 0;
    func(num1);
    func_const(num2);

    return 0;
}
```

上のコードのfunc関数では参照渡しされているnumが書き変わってしまっている  
ところが、func_const関数では**書き換えようとするとエラーが発生する**

このようにして思わぬところで不具合が起きないようにする必要がある

const参照渡しはよく使うので覚えておくべきである

### 構造体のメンバへのアクセス方法

実引数そのものなのでアロー演算子(->)ではなくドット演算子(.)を使う  
アロー演算子はポインタからメンバにアクセスするためのものだからである

## 左辺値と右辺値

C++11で規格化された仕様

これは別のファイル(section3_column_Lvalue_Rvalue.md)に書く予定なのでお楽しみに

2021/11/30
writen by 西永
